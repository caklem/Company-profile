name: Deploy to Hostinger (FTP)

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        working-directory: sleepy-spiral
        run: npm ci

      - name: Build project
        working-directory: sleepy-spiral
        run: npm run build

      - name: Verify FTP Secret
        env:
          FTP_PASSWORD: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
        run: |
          echo "🔍 Checking FTP password secret..."
          
          if [ -z "$FTP_PASSWORD" ] || [ "$FTP_PASSWORD" = "" ]; then
            echo ""
            echo "❌ ❌ ❌ ERROR: FTP PASSWORD SECRET NOT FOUND! ❌ ❌ ❌"
            echo ""
            echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
            echo "📋 CARA SETUP FTP PASSWORD:"
            echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
            echo ""
            echo "1. Buka link ini:"
            echo "   https://github.com/caklem/Company-profile/settings/secrets/actions"
            echo ""
            echo "2. Klik tombol 'New repository secret'"
            echo ""
            echo "3. Isi form:"
            echo "   Name:  HOSTINGER_FTP_PASSWORD"
            echo "   Value: [Password FTP Anda dari Hostinger]"
            echo ""
            echo "4. Klik 'Add secret'"
            echo ""
            echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
            echo "🔑 Cara dapatkan password FTP:"
            echo "   1. Login ke hPanel Hostinger"
            echo "   2. Buka 'FTP Accounts'"
            echo "   3. Username: u230709022"
            echo "   4. Lihat atau reset password"
            echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
            exit 1
          else
            echo "✅ FTP password secret ditemukan (tersembunyi)"
          fi

      - name: Deploy to Hostinger via FTP
        env:
          FTP_PASSWORD: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: 145.79.14.23
          username: u230709022
          password: ${{ env.FTP_PASSWORD }}
          local-dir: ./sleepy-spiral/dist/
          server-dir: /public_html/
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/.github/**
          dangerous-clean-slate: false
          dry-run: false

      - name: Verify deployment
        run: |
          echo "🌐 Website should be live at: https://berkahcakrasolusindo.com"
          echo "⏳ Please allow a few minutes for changes to propagate"

